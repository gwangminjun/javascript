# 비동기 프로그래밍

## 자바스크립트 엔진
자바스크립트는 단 하나의 실행 컨텍스트 스택을 갖는다.

이는 함수를 실행할 수 있는 창구가 단하나이면 동시에 2개이상의 함수를 동시에 실행할수 없다는것을 뜻한다.

실행중인 실행컨텍스트 를 제외한 모든 실행 컨텍스트는 모두 실행 대기중인 테스크들이다.

## 비동기 처리
현재 실행중인 테스크가 종료되지않은 상태라 해도 다음 태스크를 곧바로 실행하는 방식을 비동기 처리 라고한다.

비동기처리는 다음 태스크를 곧바로 실행하기 때문에 블로킹이 발생하지 않는 장점이 있지만

테스크의 실행 순서가 보장되지 않는 단점이 있다.

## 이벤트 루프
자바스크립트는 싱글스레드로 동작하므로 하나의 태스크만 처리할수 있지만 브라우저에서는 많은 테스크가 동시에 처리되는것처럼 느껴지는데 이는 자바스크립트의 동시성을 지원하는 이벤트 루프 덕분이다.

## 자바스크립트 영역
자바스크립트 영역은 크게 2개의 영역으로 구분가능하다.

1. 콜스택
    - 소스코드 평가 과정에서 생성된 실행 컨텍스트가 추가되고 제거되는 스택의 자료구조인 실행 컨텍스트 스택
    - 함수 호출시 함수의 실행 컨텍스트가 순차적으로 콜스택에 푸시되어 순차적으로 실행한다.

2. 힙
    - 객체가 저장되는 메모리 공간
    - 콜스택의 요소인 실행컨텍스트는 힙에 저장된 객체를 저장한다.
    - 메모리에 값을 저장하려면 메모리 공간의 크기를 정해야 하지만 객체는 정해져 있지 않기 때문에 객체가 저장되는 메모리공간인 힙은 구조화 되어 있지않다는 특징이 있다.

이처럼 콜스택과 힙으로 이루어진 자바스크립트 엔진은 비동기 처리가 불가능하다.

그리하여 비동기 처리시 소스코드의 평가와 실행을 제외한 모든 처리는 자바스크립트 엔진을 구동하는 환경인 브라우저 또는 Node.js 가 담당한다.

## 브라우저 환경

1. 테스크 큐
    - 비동기 함수의 콜백함수또는 이벤트 핸들러가 일시적으로 보관되는 영역
    - 큐에도 여러 종류가 있는데 프로미스의 후속처리 메서드의 콜백함수가 일시적으로 보관되는 마이크로테스크 큐 도 존재한다.

2. 이벤트 루프
    - 콜스택에 현재 실행중인 실행컨텍스트가 있는지 테스크 큐에 대기중인 함수가 있는지 반복해서 확인한다.
    - 만약 콜스택이 비어있고  테스크큐에 대기중인 함수가 있다면 이벤트루프는 순차적으로 테스크 큐에 대기중인 함수를 콜스택으로 이동시킨다.

즉 자바스크립트 엔진은 싱글 스레드로 동작하지만 브라우저는 멀티 스레드로 동작한다.


